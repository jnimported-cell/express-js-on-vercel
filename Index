const express = require('express');
const cors = require('cors');

const app = express();
app.use(express.json());

// Permite que o Lovable se conecte
app.use(cors({
  origin: '*', // pode trocar por o domínio do Lovable se quiser restringir
  methods: ['GET', 'POST', 'DELETE'],
  credentials: true
}));

// Armazenamento simples em memória
let mensagens = [];

// Endpoint para enviar mensagem
app.post('/salvar/mensagem', (req, res) => {
  const { nome, mensagem } = req.body;
  if (!nome || !mensagem) return res.status(400).json({ erro: 'Faltam campos' });
  mensagens.push({ nome, mensagem });
  res.json({ sucesso: true });
});

// Endpoint para obter mensagens
app.get('/obter/mensagens', (req, res) => {
  res.json(mensagens);
});

// Endpoint para apagar todas as mensagens
app.delete('/apagar/conversa', (req, res) => {
  mensagens = [];
  res.json({ sucesso: true });
});

// Inicialização do servidor
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Servidor ativo na porta ${PORT}`));

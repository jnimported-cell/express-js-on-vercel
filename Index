const express = require('express');
const cors = require('cors');

const app = express();
app.use(express.json());

// ðŸ› ï¸ ConfiguraÃ§Ã£o CORS â€” agora 100% compatÃ­vel com Lovable
app.use(cors({
  origin: '*', // se quiser, pode trocar pelo domÃ­nio do Lovable
  methods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS'],
  allowedHeaders: ['Content-Type', 'Authorization'],
  credentials: true
}));

// Armazenamento simples em memÃ³ria
let mensagens = [];

// Rota para salvar mensagem
app.post('/salvar/mensagem', (req, res) => {
  const { nome, mensagem } = req.body;
  if (!nome || !mensagem) return res.status(400).json({ erro: 'Campos faltando' });
  mensagens.push({ nome, mensagem });
  res.json({ status: 'OK' });
});

// Rota para obter mensagens
app.get('/obter/mensagens', (req, res) => {
  res.json(mensagens);
});

// Rota para apagar todas as mensagens
app.delete('/apagar/conversa', (req, res) => {
  mensagens = [];
  res.json({ status: 'Conversa apagada' });
});

// InicializaÃ§Ã£o do servidor
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`Servidor rodando na porta ${PORT}`));
